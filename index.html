<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Template</title>
    <!-- 添加 marked.js 用于解析 Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- 添加 yaml.js 用于解析文章元数据 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <style>
        /* CSS 样式保持不变 */
        body {
            font-family: "Microsoft YaHei", sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            height: 100vh;
            box-sizing: border-box;
        }

    </style>
</head>
<body>
    <div class="container">
        <aside class="left-sidebar">
            <div class="timeline-container">
                <div class="timeline-slider">
                    <div class="timeline-handle" id="timelineHandle"></div>
                </div>
                <div class="timeline-content" id="timeline">
                    <!-- 时间线将由 JavaScript 动态生成 -->
                </div>
            </div>
        </aside>

        <main class="main-content">
            <header class="header">
                <h1 class="site-title">Blog Template</h1>
            </header>

            <div class="motto">
                学习与生活。
            </div>

            <nav class="nav">
                <a href="#about">关于</a>
            </nav>

            <section class="recent-posts">
                <h2 id="year-title"></h2>
                <div id="posts-container">
                    <!-- 文章列表将由 JavaScript 动态生成 -->
                </div>
            </section>
        </main>

        <aside class="right-sidebar">
            <h3>标签分类</h3>
            <ul class="tag-list">
                <!-- 标签将由 JavaScript 动态生成 -->
            </ul>
        </aside>
    </div>
    <script>
        let posts = [];
        let currentTag = null;
        let currentYear = null;

        const monthNames = {
            '01': 'Jan', '02': 'Feb', '03': 'Mar', '04': 'Apr',
            '05': 'May', '06': 'Jun', '07': 'Jul', '08': 'Aug',
            '09': 'Sep', '10': 'Oct', '11': 'Nov', '12': 'Dec'
        };

        // 从GitHub加载文章列表
        async function loadPosts() {
            try {
                const owner = 'CosmoDreamist'; 
                const repo = 'blog';       
                const path = 'posts';

                const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`);
                const files = await response.json();
                
                posts = await Promise.all(files
                    .filter(file => file.name.endsWith('.md'))
                    .map(async file => {
                        const content = await fetch(file.download_url);
                        const text = await content.text();
                        const [frontMatter, ...contentParts] = text.split('---').filter(Boolean);
                        const metadata = jsyaml.load(frontMatter);
                        
                        return {
                            date: metadata.date,
                            title: metadata.title,
                            tags: metadata.tags || [],
                            content: contentParts.join('---'),
                            url: file.download_url
                        };
                    }));

                // 更新标签列表
                updateTagList();
                
                // 初始化显示
                const initialYear = posts[0]?.date.split('-')[0];
                updateYearTitle(initialYear);
                updatePosts();
                updateTimeline();
                addScrollListener();

            } catch (error) {
                console.error('Error loading posts:', error);
                document.getElementById('posts-container').innerHTML = 
                    '<p>Error loading posts. Please check the console for details.</p>';
            }
        }

        // 更新标签列表
        function updateTagList() {
            const tags = new Set();
            posts.forEach(post => {
                post.tags.forEach(tag => tags.add(tag));
            });

            const tagList = document.querySelector('.tag-list');
            tagList.innerHTML = Array.from(tags)
                .map(tag => `<li>${tag}</li>`)
                .join('');

            // 重新添加标签点击事件
            document.querySelectorAll('.tag-list li').forEach(tag => {
                tag.addEventListener('click', () => {
                    const tagText = tag.textContent;
                    if (currentTag === tagText) {
                        currentTag = null;
                        tag.classList.remove('active');
                    } else {
                        document.querySelectorAll('.tag-list li').forEach(t => {
                            t.classList.remove('active');
                        });
                        currentTag = tagText;
                        tag.classList.add('active');
                    }
                    
                    const filteredPosts = currentTag ? 
                        posts.filter(post => post.tags.includes(currentTag)) : 
                        posts;
                    
                    if (filteredPosts.length > 0) {
                        const year = filteredPosts[0].date.split('-')[0];
                        updateYearTitle(year);
                    }
                    
                    updatePosts(filteredPosts);
                    updateTimeline();
                    handle.style.top = '0px';
                });
            });
        }

        // 其他函数保持不变，只需修改updatePosts中的文章点击事件
        function updatePosts(filteredPosts = posts) {
            if (currentTag) {
                filteredPosts = filteredPosts.filter(post => post.tags.includes(currentTag));
            }

            if (filteredPosts.length > 0) {
                const latestYear = filteredPosts[0].date.split('-')[0];
                updateYearTitle(latestYear);
            }

            const container = document.getElementById('posts-container');
            container.innerHTML = filteredPosts
                .sort((a, b) => b.date.localeCompare(a.date))
                .map(post => {
                    const [year, month, day] = post.date.split('-');
                    const formattedDate = `${monthNames[month]} ${day}`;
                    return `
                        <div class="post-item" data-date="${post.date}" data-url="${post.url}">
                            <span class="post-date">${formattedDate}</span>
                            <span class="post-title">
                                ${post.title}
                                ${post.tags.map(tag => `
                                    <span class="post-tag">${tag}</span>
                                `).join('')}
                            </span>
                        </div>
                    `;
                }).join('');

            // 添加文章点击事件
            document.querySelectorAll('.post-item').forEach(item => {
                item.addEventListener('click', async () => {
                    const url = item.dataset.url;
                    try {
                        const response = await fetch(url);
                        const text = await response.text();
                        const [frontMatter, ...contentParts] = text.split('---').filter(Boolean);
                        const content = contentParts.join('---');
                        
                        // 这里可以添加显示文章内容的逻辑
                        // 例如：打开一个模态框显示文章
                        console.log('Article content:', marked.parse(content));
                    } catch (error) {
                        console.error('Error loading article:', error);
                    }
                });
            });
        }

        // 保持其他所有函数不变
        function updateYearTitle(year) { /* ... */ }
        function updateTimeline() { /* ... */ }
        function addScrollListener() { /* ... */ }

        // 初始化
        loadPosts();

        // 滑块相关代码保持不变
        const handle = document.getElementById('timelineHandle');
        const slider = document.querySelector('.timeline-slider');
        let isDragging = false;

        handle.addEventListener('mousedown', (e) => {
            isDragging = true;
        });

        // ... 其他事件监听器保持不变 ...

    </script>
</body>
</html>
